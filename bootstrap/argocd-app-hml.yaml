apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: eqt-poc-quarkus-hml # Static name for the ArgoCD Application that deploys the Helm chart
  namespace: openshift-gitops # The namespace where ArgoCD is running
spec:
  project: default
  source:
    #repoURL: https://repositorio.equatorial.corp/equatorial/gmz/eqt-openshift-gitops.git # URL do seu repositório Git
    repoURL: https://github.com/rsoares21/eqt-openshift-gitops.git # URL do seu repositório Git
    targetRevision: main # Branch ou tag a ser monitorada
    path: helm # Caminho para o diretório raiz do seu Helm chart dentro do repositório
    helm:
      valueFiles:
      - values-hml.yaml # Indica ao ArgoCD para usar o values.yaml padrão do chart
  destination:
    server: https://kubernetes.default.svc
    namespace: eqt-poc-quarkus-hml # O namespace onde a aplicação será implantada no OpenShift
  syncPolicy:
    automated:
      prune: true     # Se true, o ArgoCD removerá recursos do cluster que não estão no Git.
      selfHeal: true  # Se true, o ArgoCD aplicará automaticamente as mudanças do Git no cluster.
                      # Defina como 'false' para exigir sincronização manual (aprovação).
    syncOptions:
      - CreateNamespace=true
  # Ignora a diferença entre a tag da imagem no Git e o digest (sha256) no cluster,
  # que é um comportamento padrão do OpenShift e causava o loop de OutOfSync.
  ignoreDifferences:
  - group: apps
    kind: Deployment
    jsonPointers:
    - /spec/template/spec/containers/0/image
